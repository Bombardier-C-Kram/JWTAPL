 r←secret encode(h p);secret;alg;tkn;eh;ep;d;gsig;_
 ⍝(secret)←a
 alg←h.alg

 :If alg≡'HS256'
     eh ep←base64¨⎕UCS¨⎕JSON¨h p
     eh ep←~∘'='¨eh ep
     gsig←secret HmacSha256 eh,'.',ep
     gsig←~∘'='base64 gsig
 :Else
     gsig←''
 :EndIf

 :If ~gsig≡''
     r←(,/eh,'.',¨ep gsig)
 :Else
     r←(h p'')
 :EndIf
